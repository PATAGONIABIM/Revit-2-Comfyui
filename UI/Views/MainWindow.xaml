<!-- ===== UI/Views/MainWindow.xaml ===== -->
<Window x:Class="WabiSabiRevitBridge.UI.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        mc:Ignorable="d"
        Title="WabiSabi Bridge"
        Height="800" Width="600"
        WindowStartupLocation="CenterScreen"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="13"
        TextOptions.TextFormattingMode="Ideal"
        TextOptions.TextRenderingMode="Auto"
        Background="{DynamicResource MaterialDesignPaper}"
        FontFamily="{DynamicResource MaterialDesignFont}">
    
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </Window.Resources>

    <materialDesign:DialogHost Identifier="RootDialog">
        <DockPanel>
            <!-- Status Bar -->
            <StatusBar DockPanel.Dock="Bottom" Height="30">
                <StatusBar.ItemsPanel>
                    <ItemsPanelTemplate>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                        </Grid>
                    </ItemsPanelTemplate>
                </StatusBar.ItemsPanel>
                
                <StatusBarItem Grid.Column="0">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Connection" VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <TextBlock Text="{Binding ConnectionStatus}" VerticalAlignment="Center"/>
                    </StackPanel>
                </StatusBarItem>
                
                <StatusBarItem Grid.Column="2">
                    <TextBlock Text="{Binding PerformanceMetrics}" VerticalAlignment="Center"/>
                </StatusBarItem>
                
                <StatusBarItem Grid.Column="3">
                    <TextBlock Text="{Binding ChannelInfo}" VerticalAlignment="Center" Margin="10,0"/>
                </StatusBarItem>
                
                <StatusBarItem Grid.Column="4">
                    <ProgressBar Width="100" Height="10" 
                                IsIndeterminate="{Binding IsProcessing}"
                                Visibility="{Binding IsProcessing, Converter={StaticResource BoolToVis}}"/>
                </StatusBarItem>
            </StatusBar>

            <!-- Main Content -->
            <Grid>
                <materialDesign:DrawerHost IsLeftDrawerOpen="{Binding IsSettingsOpen}">
                    <!-- Settings Drawer -->
                    <materialDesign:DrawerHost.LeftDrawerContent>
                        <DockPanel Width="300">
                            <materialDesign:ColorZone Mode="PrimaryDark" DockPanel.Dock="Top" Padding="16">
                                <TextBlock Text="Settings" Style="{StaticResource MaterialDesignHeadline6TextBlock}"/>
                            </materialDesign:ColorZone>
                            
                            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="16">
                                <StackPanel>
                                    <!-- Communication Settings -->
                                    <TextBlock Text="Communication" Style="{StaticResource MaterialDesignSubtitle1TextBlock}" Margin="0,0,0,8"/>
                                    <ComboBox materialDesign:HintAssist.Hint="Channel Mode"
                                            ItemsSource="{Binding CommunicationModes}"
                                            SelectedItem="{Binding SelectedCommunicationMode}"
                                            Margin="0,0,0,16"/>
                                    
                                    <!-- Export Settings -->
                                    <TextBlock Text="Export Settings" Style="{StaticResource MaterialDesignSubtitle1TextBlock}" Margin="0,16,0,8"/>
                                    
                                    <Grid Margin="0,0,0,8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBox Grid.Column="0" 
                                               materialDesign:HintAssist.Hint="Width"
                                               Text="{Binding ExportWidth}"/>
                                        <TextBlock Grid.Column="1" Text=" x " VerticalAlignment="Center" Margin="8,0"/>
                                        <TextBox Grid.Column="2" 
                                               materialDesign:HintAssist.Hint="Height"
                                               Text="{Binding ExportHeight}"/>
                                    </Grid>
                                    
                                    <Slider Minimum="1" Maximum="100" 
                                          Value="{Binding Quality}"
                                          materialDesign:HintAssist.Hint="Quality"
                                          TickFrequency="10"
                                          TickPlacement="BottomRight"
                                          Margin="0,8,0,16"/>
                                    
                                    <!-- Performance Settings -->
                                    <TextBlock Text="Performance" Style="{StaticResource MaterialDesignSubtitle1TextBlock}" Margin="0,16,0,8"/>
                                    
                                    <CheckBox Content="Enable Cache" 
                                            IsChecked="{Binding EnableCache}"
                                            Margin="0,0,0,8"/>
                                    
                                    <CheckBox Content="Parallel Processing" 
                                            IsChecked="{Binding ParallelProcessing}"
                                            Margin="0,0,0,8"/>
                                    
                                    <CheckBox Content="Adaptive Sampling" 
                                            IsChecked="{Binding AdaptiveSampling}"
                                            Margin="0,0,0,16"/>
                                    
                                    <Slider Minimum="1" Maximum="30" 
                                          Value="{Binding AutoModeThrottleFps}"
                                          materialDesign:HintAssist.Hint="Auto Mode FPS"
                                          TickFrequency="5"
                                          TickPlacement="BottomRight"
                                          IsEnabled="{Binding IsAutoMode}"/>
                                </StackPanel>
                            </ScrollViewer>
                        </DockPanel>
                    </materialDesign:DrawerHost.LeftDrawerContent>

                    <!-- Main Content Area -->
                    <DockPanel>
                        <!-- Toolbar -->
                        <materialDesign:ColorZone Mode="PrimaryMid" DockPanel.Dock="Top" 
                                                Effect="{DynamicResource MaterialDesignShadowDepth2}">
                            <Grid Height="56">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- Menu Button -->
                                <Button Grid.Column="0" 
                                      Style="{StaticResource MaterialDesignIconButton}"
                                      Command="{Binding ToggleSettingsCommand}"
                                      Margin="8">
                                    <materialDesign:PackIcon Kind="Menu" Height="24" Width="24"/>
                                </Button>
                                
                                <!-- Title -->
                                <TextBlock Grid.Column="1" 
                                         Text="WabiSabi Bridge" 
                                         VerticalAlignment="Center"
                                         Style="{StaticResource MaterialDesignHeadline6TextBlock}"/>
                                
                                <!-- Action Buttons -->
                                <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="8">
                                    <Button Style="{StaticResource MaterialDesignIconButton}"
                                          Command="{Binding ShowHelpCommand}"
                                          ToolTip="Help">
                                        <materialDesign:PackIcon Kind="HelpCircle" Height="24" Width="24"/>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </materialDesign:ColorZone>

                        <!-- Content Tabs -->
                        <TabControl DockPanel.Dock="Top" 
                                  materialDesign:ColorZoneAssist.Mode="PrimaryMid"
                                  Style="{StaticResource MaterialDesignNavigatilTabControl}">
                            
                            <!-- Main Tab -->
                            <TabItem Header="CONTROL">
                                <ScrollViewer VerticalScrollBarVisibility="Auto">
                                    <StackPanel Margin="16">
                                        <!-- Mode Selection -->
                                        <GroupBox Header="Operation Mode" Margin="0,0,0,16">
                                            <StackPanel>
                                                <RadioButton Content="Manual" 
                                                           IsChecked="{Binding IsManualMode}"
                                                           Margin="0,8,0,4"/>
                                                <RadioButton Content="Automatic" 
                                                           IsChecked="{Binding IsAutoMode}"
                                                           Margin="0,4,0,4"/>
                                                <RadioButton Content="Batch" 
                                                           IsChecked="{Binding IsBatchMode}"
                                                           Margin="0,4,0,8"/>
                                            </StackPanel>
                                        </GroupBox>

                                        <!-- Control Buttons -->
                                        <Grid Margin="0,0,0,16">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <Button Grid.Column="0" 
                                                  Content="UPDATE"
                                                  Command="{Binding UpdateCommand}"
                                                  Style="{StaticResource MaterialDesignRaisedButton}"
                                                  Margin="4"
                                                  Height="40">
                                                <Button.Icon>
                                                    <materialDesign:PackIcon Kind="Play"/>
                                                </Button.Icon>
                                            </Button>
                                            
                                            <Button Grid.Column="1" 
                                                  Content="PAUSE"
                                                  Command="{Binding PauseCommand}"
                                                  Style="{StaticResource MaterialDesignRaisedSecondaryButton}"
                                                  Margin="4"
                                                  Height="40"
                                                  IsEnabled="{Binding IsRunning}">
                                                <Button.Icon>
                                                    <materialDesign:PackIcon Kind="Pause"/>
                                                </Button.Icon>
                                            </Button>
                                            
                                            <Button Grid.Column="2" 
                                                  Content="STOP"
                                                  Command="{Binding StopCommand}"
                                                  Style="{StaticResource MaterialDesignRaisedSecondaryButton}"
                                                  Margin="4"
                                                  Height="40"
                                                  IsEnabled="{Binding IsRunning}">
                                                <Button.Icon>
                                                    <materialDesign:PackIcon Kind="Stop"/>
                                                </Button.Icon>
                                            </Button>
                                        </Grid>

                                        <!-- Data Selection -->
                                        <GroupBox Header="Export Data" Margin="0,0,0,16">
                                            <StackPanel>
                                                <CheckBox Content="Hidden Lines" 
                                                        IsChecked="{Binding ExportHiddenLines}"
                                                        Margin="0,8,0,4"/>
                                                <CheckBox Content="Depth Map" 
                                                        IsChecked="{Binding ExportDepth}"
                                                        Margin="0,4,0,4"/>
                                                <CheckBox Content="Segmentation" 
                                                        IsChecked="{Binding ExportSegmentation}"
                                                        Margin="0,4,0,4"/>
                                                <CheckBox Content="Normal Map" 
                                                        IsChecked="{Binding ExportNormals}"
                                                        Margin="0,4,0,4"/>
                                                <CheckBox Content="Metadata" 
                                                        IsChecked="{Binding ExportMetadata}"
                                                        Margin="0,4,0,8"/>
                                            </StackPanel>
                                        </GroupBox>

                                        <!-- Preview Section -->
                                        <GroupBox Header="Preview" Margin="0,0,0,16">
                                            <Grid Height="200">
                                                <Border BorderBrush="{DynamicResource MaterialDesignDivider}" 
                                                      BorderThickness="1"
                                                      CornerRadius="4">
                                                    <Grid>
                                                        <Image Source="{Binding PreviewImage}" 
                                                             Stretch="Uniform"
                                                             HorizontalAlignment="Center"
                                                             VerticalAlignment="Center"/>
                                                        <TextBlock Text="No preview available" 
                                                                 HorizontalAlignment="Center"
                                                                 VerticalAlignment="Center"
                                                                 Visibility="{Binding HasPreview, Converter={StaticResource BoolToVis}, ConverterParameter=Inverted}"/>
                                                    </Grid>
                                                </Border>
                                            </Grid>
                                        </GroupBox>
                                    </StackPanel>
                                </ScrollViewer>
                            </TabItem>

                            <!-- Profiles Tab -->
                            <TabItem Header="PROFILES">
                                <Grid Margin="16">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <TextBlock Grid.Row="0" 
                                             Text="Export Profiles" 
                                             Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                             Margin="0,0,0,16"/>
                                    
                                    <ListBox Grid.Row="1" 
                                           ItemsSource="{Binding Profiles}"
                                           SelectedItem="{Binding SelectedProfile}"
                                           Margin="0,0,0,16">
                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <Border Padding="16,8" BorderThickness="0,0,0,1" 
                                                      BorderBrush="{DynamicResource MaterialDesignDivider}">
                                                    <StackPanel>
                                                        <TextBlock Text="{Binding Name}" 
                                                                 Style="{StaticResource MaterialDesignSubtitle1TextBlock}"/>
                                                        <TextBlock Text="{Binding Description}" 
                                                                 Opacity="0.7"
                                                                 TextWrapping="Wrap"/>
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                    </ListBox>
                                    
                                    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
                                        <Button Content="LOAD" 
                                              Command="{Binding LoadProfileCommand}"
                                              Style="{StaticResource MaterialDesignFlatButton}"
                                              Margin="0,0,8,0"/>
                                        <Button Content="SAVE AS..." 
                                              Command="{Binding SaveProfileCommand}"
                                              Style="{StaticResource MaterialDesignFlatButton}"/>
                                    </StackPanel>
                                </Grid>
                            </TabItem>

                            <!-- Debug Tab -->
                            <TabItem Header="DEBUG">
                                <Grid Margin="16">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <TextBlock Grid.Row="0" 
                                             Text="Debug Log" 
                                             Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                             Margin="0,0,0,16"/>
                                    
                                    <Border Grid.Row="1" 
                                          BorderBrush="{DynamicResource MaterialDesignDivider}" 
                                          BorderThickness="1"
                                          CornerRadius="4"
                                          Margin="0,0,0,16">
                                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                                            <TextBox Text="{Binding DebugLog}" 
                                                   IsReadOnly="True"
                                                   FontFamily="Consolas"
                                                   FontSize="12"
                                                   Background="Transparent"
                                                   BorderThickness="0"
                                                   Padding="8"/>
                                        </ScrollViewer>
                                    </Border>
                                    
                                    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
                                        <Button Content="CLEAR" 
                                              Command="{Binding ClearLogCommand}"
                                              Style="{StaticResource MaterialDesignFlatButton}"
                                              Margin="0,0,8,0"/>
                                        <Button Content="EXPORT LOG" 
                                              Command="{Binding ExportLogCommand}"
                                              Style="{StaticResource MaterialDesignFlatButton}"/>
                                    </StackPanel>
                                </Grid>
                            </TabItem>
                        </TabControl>
                    </DockPanel>
                </materialDesign:DrawerHost>
            </Grid>
        </DockPanel>
    </materialDesign:DialogHost>
</Window>