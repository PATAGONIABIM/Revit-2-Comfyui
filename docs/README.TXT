# WabiSabi Bridge para Revit 2026 - MVP

## üéØ Funcionalidad Actual (MVP)

Esta es la versi√≥n m√≠nima funcional del plugin WabiSabi Bridge. Actualmente incluye:

- ‚úÖ Exportaci√≥n manual de la vista 3D activa
- ‚úÖ Exportaci√≥n de imagen con l√≠neas ocultas
- ‚úÖ Exportaci√≥n de metadatos b√°sicos (JSON)
- ‚úÖ Modo autom√°tico experimental (exporta cada 2 segundos)
- ‚úÖ Interfaz de usuario simple
- ‚úÖ Configuraci√≥n persistente

## üìã Requisitos

- Autodesk Revit 2026
- .NET Framework 4.8
- Visual Studio 2022 (para compilar)
- Windows 10/11

## üîß Instalaci√≥n

### Opci√≥n 1: Compilar desde c√≥digo fuente

1. **Clonar o descargar los archivos**:
   - `WabiSabiBridge.cs`
   - `WabiSabiBridge.csproj`
   - `WabiSabiBridge.addin`

2. **Abrir el proyecto en Visual Studio 2022**:
   ```bash
   # Abrir Visual Studio y cargar WabiSabiBridge.csproj
   ```

3. **Ajustar la ruta de Revit** (si es necesario):
   - Editar `WabiSabiBridge.csproj`
   - Modificar `<RevitInstallPath>` si Revit est√° en otra ubicaci√≥n

4. **Compilar el proyecto**:
   - Build ‚Üí Build Solution (Ctrl+Shift+B)
   - El proyecto se compilar√° e instalar√° autom√°ticamente

### Opci√≥n 2: Instalaci√≥n manual

1. **Copiar archivos al directorio de Addins**:
   ```
   C:\Users\[TuUsuario]\AppData\Roaming\Autodesk\Revit\Addins\2026\
   ```
   - `WabiSabiBridge.dll`
   - `WabiSabiBridge.addin`

2. **Reiniciar Revit**

## üöÄ Uso

### Primera vez:

1. **Abrir Revit 2026** y cargar un proyecto
2. **Activar una vista 3D**
3. **Ir a la pesta√±a "WabiSabi"** en el ribbon
4. **Hacer clic en "WabiSabi Bridge"**

### Ventana del plugin:

1. **Configurar carpeta de salida**:
   - Por defecto: `Documentos\WabiSabiBridge`
   - Usar bot√≥n "..." para cambiar

2. **Exportar manualmente**:
   - Clic en "Exportar Vista Actual"
   - Se generar√°n archivos:
     - `current_render.png` - Imagen de l√≠neas ocultas
     - `current_metadata.json` - Informaci√≥n de la vista
     - `last_update.txt` - Timestamp de actualizaci√≥n

3. **Modo autom√°tico** (experimental):
   - Activar checkbox "Exportaci√≥n autom√°tica"
   - Exportar√° cada 2 segundos si detecta cambios

## üìÅ Estructura de archivos exportados

```
WabiSabiBridge/
‚îú‚îÄ‚îÄ current_render.png      # Imagen actual (se sobrescribe)
‚îú‚îÄ‚îÄ current_metadata.json   # Metadatos actuales
‚îú‚îÄ‚îÄ last_update.txt        # Timestamp de √∫ltima actualizaci√≥n
‚îú‚îÄ‚îÄ render_20240115_143022.png  # Archivos con timestamp (hist√≥rico)
‚îî‚îÄ‚îÄ ...
```

## üîÑ Integraci√≥n con ComfyUI

En ComfyUI, usar el nodo `Watch Image` (del otro plan) apuntando a:
- Imagen: `[carpeta]\current_render.png`
- Metadatos: `[carpeta]\current_metadata.json`

## üêõ Problemas conocidos (MVP)

- El modo autom√°tico exporta siempre (no detecta cambios reales)
- Solo exporta l√≠neas ocultas (sin profundidad, normales, etc.)
- La posici√≥n de c√°mara en metadatos est√° hardcodeada
- No hay indicador de progreso para modelos grandes

## üîß Soluci√≥n de problemas comunes

### Error: "Starting a transaction from an external application"
**Causa**: Conflicto de versiones + contexto de transacci√≥n inv√°lido
**Soluci√≥n**: Usar el script `FixVersionBuild.bat` que corrige ambos problemas

### Error: Referencias ambiguas (Form, TextBox, Color)
**Soluci√≥n**: Ya corregido en el c√≥digo usando alias para namespaces

### Error: Elementos "Compile" duplicados
**Soluci√≥n**: Ya corregido removiendo la secci√≥n problem√°tica del .csproj

### Error: "IsVisible" no existe
**Soluci√≥n**: Ya corregido usando `IsDisposed` en lugar de `IsVisible`

### Error: Conflicto de versiones de ensamblados
**Soluci√≥n**: Usar `FixVersionBuild.bat` que evita copiar DLLs del sistema

### Error: No se encuentra Revit API
**Soluci√≥n**: Verificar que Revit 2026 est√© instalado o actualizar la ruta en el .csproj

Para m√°s detalles, ver:
- `COMPILATION_FIX.md` - Errores de compilaci√≥n
- `VERSION_CONFLICT_FIX.md` - Conflictos de versiones y transacciones

## üöß Pr√≥ximas iteraciones

**v0.2 - Mejoras b√°sicas**:
- [ ] Detecci√≥n real de cambios en la vista
- [ ] Barra de progreso durante exportaci√≥n
- [ ] Configuraci√≥n de resoluci√≥n

**v0.3 - M√°s tipos de datos**:
- [ ] Exportar mapa de profundidad
- [ ] Exportar segmentaci√≥n por categor√≠as
- [ ] Posici√≥n real de c√°mara

**v0.4 - Optimizaci√≥n**:
- [ ] Named pipes para comunicaci√≥n directa
- [ ] Cach√© para evitar re-exportar
- [ ] Procesamiento en background thread

**v1.0 - Versi√≥n completa**:
- [ ] Todos los extractores del plan original
- [ ] UI avanzada con tabs
- [ ] Modo batch
- [ ] Documentaci√≥n completa

## üìù Notas de desarrollo

- El plugin usa `ImageExportOptions` de Revit API para exportar
- La configuraci√≥n se guarda en `%APPDATA%\WabiSabiBridge\config.json`
- Los logs de error aparecen en los di√°logos de Revit

## ü§ù Contribuir

Para reportar bugs o sugerir mejoras, por favor documentar:
1. Versi√≥n de Revit
2. Descripci√≥n del problema
3. Pasos para reproducir
4. Mensajes de error (si los hay)

---

**WabiSabi Bridge MVP v0.1** - Enero 2024